
{% load static %}
<!DOCTYPE html>
<html>
<head>
<title>Registration</title>

<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catalog-Z Bootstrap 5.0 HTML Template</title>
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'fontawesome/css/all.min.css'%}">
    <link rel="stylesheet" href="{% static 'css/templatemo-style.css' %}">
</head>
<body>   
    <link rel="stylesheet" type='text/css' href="#">

    <div class="content">
        <div id="profile_title">
            <h3>사용된 기술(Used Skill)</h3>
        </div><br>
        <a href="{% url 'index' %}">HOME</a><br><br>
<!-- 
        <br>##########################################################################################################
        <br> 위 코드 삭제하지 말 것 - 페이지를 보이기 위해 필요
        <br>##########################################################################################################
-->

        <div id="profile_main">
            <ul>
                <li>
                    <h3>
                        <a href="#">
                            <strong>@index:bootstrap</strong>
                        </a>
                    </h3>
                    link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}"
                    <br>이 css는 col 을 4등분해서 shopping item을 보여주는데 필요하다.
                    <br>div class="col-xl-3 col-lg-4 col-md-6 col-sm-6 col-12 mb-5"
                    <br>이 코드와 매치되는 것같다
                    <br>
                    <br>###########################################################################
                    <br>link rel="stylesheet" href="{% static 'css/templatemo-style.css' %}"
                    <br>이 css는 이미지 위에 캡션을 주고 멋있게 하고 텍스트를 grey로도 바꿀 때 필요하다.
                    <br>figure class="effect-ming tm-video-item"
                    <br>figcaption class="d-flex align-items-center justify-content-center"
                    <br>div class="d-flex justify-content-between tm-text-gray"
                    <br>이 코드들과 매치되는 것같다
                    <br>
                    <br>link rel="stylesheet" href="{% static 'css/templatemo-style.css' %}"
                    <br><!-- Page Loader -->
                    <br>div id="loader-wrapper" .../div
                    <br>div id="loader" /div
                    <br>div class="loader-section section-left"
                    <br>div class="loader-section section-right"
                    <br>이 4줄은 페이지가 뜰 때 원형의 모양이 생기면서 공백없이 뜨게 한다
                    <br>static 'css/templatemo-style.css보면 여러가지 모양의 style을 구현하는 temolate가 있다 
                    <br>.tm-hero : in css/templatemo-style.css, big background image  백그라운드 구현

                    <br><br>Search버튼 .form-control/.tm-search-input/.tm-search-btn /써치 버튼 
                    <br>nav-item/nav-link/.tm-search-btn
                    <br>Search버튼 .form-control/.tm-search-input/.tm-search-btn
                    <br>이상 모든 것이 거의 다 templatemo-style.css 로 옴.

                    <br>##########################################################################################################
                    <br>bootstrap 5  - @settings.py  'crispy_bootstrap5', 
                    <br>d-flex  (To create a flexbox container)  justify-content-center (flex를 중앙에 위치)
                    <br>To create a flexbox container and to transform direct children into flex items, use the d-flex class:
                    <br>이것은 전에 float로 하던 것으로 flexbox container를 만들어서 아래 좌 우 중앙으로 개체를 정렬해 보이는 것같다
                    <br><br>
                    <br>link rel="stylesheet" href="{% static 'fontawesome/css/all.min.css'%}" 
                    <br>fas fa-search를 가능하게 하는 css. search 오른편 아이콘 생성
                    <br>i class="fas fa-film mr-2" 필름 아이콘 생성
                    <br>fontawesome/css/all.min.css를 쓰면 fas fa 아이콘 가능
                    <br>##########################################################################################################
                    <br><br>@index.html - 디스카운트 오퍼 item은 flag를 붙여주기 위해 아래 처럼 구현함
                    <br>% if dest.offer %
                    <br>i class="fas fa-flag"/i% endif %



                </li><br><br>
                <li>
                    <h3>
                        <a href="...">
                            <strong>@food_create</strong>
                        </a>
                    </h3>
                    food create를 staff만 할 수 있게 하려면
                    <br>방법#1: @views.py<br>from django.contrib.admin.views.decorators import staff_member_required
                    <br>@staff_member_required
                    <br>def food_create(request):<br>
                    <br>방법#2: 
                    <br>@food_create.html
                    <br>% if request.user.is_superuser %
                    <br>% else %
                    <br>a href="{% url 'index' %}" class="btn btn-primary">BACK HOME - NO ACCESS 
                    <br>여기서는 방법#2를 사용함.
                    
                    <br>@forms.py:from django.forms import ModelForm
                    <br>class NewFoodForm(forms.ModelForm):
                    <br>@food_create.html:form method="POST" action=" " enctype="multipart/form-data"
                    <br>이것은 파일을 올리는 것이므로 enctype="multipart/form-data" 이 부분이 필요하다
                    <br><br>% load crispy_forms_tags % 'crispy_forms',
                    <br>crispy form을 쓰려고 한 것인데 이것을 쓰려면 아래와 같이 설치 후 등록이 선행되어야한다
                    <br>pip install django-crispy-forms,crispy_bootstrap5
                    <br>@settings.py INSTALLED_APPS = 'crispy_forms','crispy_bootstrap5', 
                    <br>crispy form은 modelform에서 form_p 를 보완해서 보기 좋게 한 것
                    <br><br>action=" "는 폼 작성 후 어디로 가는 것이 아니라 
                    <br>veiws.py에서 if request.method == 'POST': 의 경우가 되게 한다
                    <br><br>if request.method == 'POST':
                    <br>form = NewFoodForm(request.POST, request.FILES):이것은 파일을 올리는 것이므로 request.FILES.
                    <br>
                    <br>if form.is_valid:
                    <br>cleaned_data = form.cleaned_data
                    <br>p=Destination
                    <br>name = request.POST name 이런 형식으로 직접 p.save를 한다
                    <br>게시판save(commit=False)과 다른 형식으로 저장하는 방법이고
                    <br>NewFoodForm(forms.ModelForm)에서 widgets는 html의 crispy form과 상관없이 정해주어야 한다
                   
                   
                    




                </li><br><br>

                <br>##########################################################################################################

                <li>
                    <h3>
                        <a href="...">
                            <strong>@% url 'detail' dest.pk %</strong>
                        </a>
                    </h3>
                    @views.py<br>% if request.user.is_superuser %
                    <br>'food_edit' destination.pk/'food_delete' destination.pk
                    <br>super user만 food 를 edit하고 delete 버튼을 볼 수 있다.
                    <br><br>dest.pk에 해당하는 쇼핑 아이템 세부 정보를 나열함
                    <br>destination.image.url
                    <br>destination.price  
                    <br><br>detail정보를 보여주고 여기서 ADD SHOPPING CART를 만들어 준다.
                    <br>form action="% url 'cart' destination.pk %", method="POST"
                    <br>% csrf_token % 
                    <br>input type="number" name="quantity" id="quantity" value="1"  
                    <br>dest.pk에 해당하는 destination.quantity를 input 하게 하는 폼
                    <br>button type="submit" name="cart" value="cart"
                    <br>폼 입력된 숫자는 cart로 보내짐
                </li><br><br>

                <br>##########################################################################################################

                <li>
                    <h3>
                    <a href="...">
                        <strong>CART-CREATE</strong>
                    </a>
                    </h3>
                    @views.py<br>def cart(request, destination_id):
                    <br>정보를 가져와
                    <br>#quantity = request.POST.get('quantity')
                    <br>#destination=get_object_or_404(Destination,id=destination_id)
                    <br>#user = request.user#login user
   
                    <br>cart model - user/destination/quantity
                    <br>정보를 가져와 cart object를 만든다
                    <br>#Cart.objects.create(user=user, destinations=destination, quantity=quantity)

                    <br><br>만일 그 user의 그 destination에 이미 cart가 존재한다면 
                    <br>#cart = Cart.objects.filter(user=user)-그 user의 모든 cart 
                    <br>각 cart를 불러 for i in cart :
                    <br>#if i.destinations == destination에 해당하는 destination이 있으면
                    <br>#destination = Destination.objects.filter(pk=destination_id)#갈비 정보
                    <br>#destination의 cart에 담은 수를 더해준다.
                    <br>#Cart.objects.filter(user=user, destinations__in=destination).update(quantity=F('quantity') + quantity)

                    <br><br>필드 Lookup:__in
                    <br>#class User(models.Model):
                    <br>#city = models.CharField(max_length=100)
                    <br>#users_in_london_or_paris = User.objects.filter(city__in=['London', 'Paris'])
                    <br>이 예시에서 `city__in=['London', 'Paris']`는 도시가 'London' 또는 'Paris'인 사용자들을 필터링합니다
                    <br>가독성 향상: __in을 사용하면 복잡한 조건을 더 명확하고 가독성 좋게 작성할 수 있습니다
                    
                    <br>__in 외에도 다양한 필드 lookup이 존재하며, __contains, __exact, __gt, __lt 등이 있습니다. 
                    <br><br>#messages.success(request,'장바구니 등록 완료')
                    <br>#return redirect('cartview', user.pk)
                    <br>cartview로는 그 user의 cart 정보를 보여주어야 한다.
                    <br>#path('cartview/int:user_id/', views.cartview, name='cartview'),
                </li><br><br>

                <br>##########################################################################################################
                <li>
                    <h3>
                    <a href="...">
                        <strong>CART-VIEW</strong>
                    </a>
                    </h3>
                    @views.py<br>#def cartview(request, user_id):
                    <br>#user = User.objects.get(pk=user_id)
                    <br>#cart = Cart.objects.filter(user=user)
                    <br>#context = {'user': user, 'cart': cart }
                    <br>#return render(request, 'cartview.html', context)
                    <br><br>@cartview.html
                    <br>#for destination in cart:cart 안에 든 것을 하나씩 보여주기 위해
                    <br>#destination.destinations.name - ForeignKey
                    <br>#destination.quantity
                    <br>#destination.destinations.price - ForeignKey
                    <br><br><strong>CART-DELETE</strong>
                    <br><br>cart에 든 것을 모두 보여주고 여기서 필요없는 cart 품목을 삭제할 수 있게 하기위해서
                    <br>cart에 든 것 중 해당 품목을(destination.destinations.id) 선택해서 POST 하여 cart delete에서 DELETE
                    <br>#input type="radio" id="destination_ destination.id " name="destination" value="destination.destinations.id" checked="checked"
                    <br>#form action="% url 'delete_cart' user.pk %" method="POST
                    <br>#button type="submit" name="delete_cart" value="delete_cart"
                    <br>#% csrf_token % 
                    <br>그 user의 cart로 가서 해당 품목(destination.destinations.id)을 delete하기 위해 
                    <br>user.pk를 인자로 cart 에 보내고 cart의 해당 품목은 input select POST하는 것 


                </li><br><br>

                    <h3>
                    <a href="...">
                        <strong>CART-DELETE</strong>
                    </a>
                    </h3>
                    @views.py<br>#def delete_cart(request, user_id)
                    <br>#user = User.objects.get(pk=user_id)
                    <br>#user = request.user
                    <br>#cart = Cart.objects.filter user=user
                    <br>#quantity = 0
                    <br>#pk =int(request.POST.get('destination')):destination은 폼에서 name의 해당 품목(destination.destinations.id) 
                    <br>곧 해당 품목의 ID를 받아서 거기에 해당되는 cart object를 가져오기 위해
                    <br>#destination = Destination.objects.filter(pk=pk)
                    <br>#for i in cart:user=user가 갈비도 스시도 카트에 넣을 수 있어서 
                    <br>#if i.destinations == destination : 그 중에 넘어온 해당품목인 경우에만  
                    <br>#quantity =  i.quantity : quantity에 카트에 있는 수를 지정
                    <br>#if quantity > 0 or quantity == 0: 이것은 마이너스만 아니면 된다는 것이니 
                    <br>#destination = Destination.objects.filter(pk=pk)
                    <br>#cart = Cart.objects.filter(user=user, destinations__in=destination)
                    <br>#cart.delete()


                    <br>
                    <br>아래 것만 하면 왜 안될까?
                    <br>#destination = Destination.objects.filter(pk=pk)
                    <br>#cart = Cart.objects.filter(user=user, destinations__in=destination)
                    <br>#cart.delete()

                    <br>왜 아래 것이 필요한가?
                    <br>#for i in cart:user=user가 갈비도 스시도 카트에 넣을 수 있어서 
                    <br>#if i.destinations == destination : 그 중에 넘어온 해당품목인 경우에만  
                    <br>#quantity =  i.quantity : quantity에 카트에 있는 수를 지정
                    <br>#if quantity > 0 or quantity == 0: 이것은 마이너스만 아니면 된다는 것이니 

                </li><br><br>

                <h3>
                <a href="...">
                    <strong>CHECKOUT</strong>
                </a>
                </h3>
                <strong>@cartview.html</strong>
                <br>a href="% url 'checkout' user.id %" PLACE ORDER
                <br>@views.py:def checkout(request, user_id):

                <br>#user = request.user
                <br>#allorder = Allorder.objects.filter(user=user)
                <br>#allorder.delete()
                <br>before checkout, all old order should be deleted

                <br>#all_items = Cart.objects.filter(user=user)
                <br>#그 user의 cart에는 여러 item이 이미 저장되어 있으니 all items를 Allorder에 저장해야
                
                <br>#for cart_item in all_items:
                <br>#li = Allorder user=user, quantity = cart_item.quantity,destinations = cart_item.destinations,
                <br>#li.save()
                <br>#all_items.delete()
                <br>이와같은 방식으로 for를 써서 Allorder 에 모든 cart_item들을 저장하고 
                <br>모든 cart_item들을 삭제한다

                <br>#####################################################################################
                <br>
                <br><strong>만일 여기서 checkout(주소입력)없이 바로 payment로 가려면</strong>
                <br>#Allorder Model모델에 아래 add
                <br># def sum_cost(self):
                <br>#return sum([ li.cost() for li in self.all() ] )  
                <br>그리고 payment로 바로 가게 해서 아래와 같이 구현하면 될 것같다  
                <br>#def payment(request, user_id):
                <br>#delete all checkorder
                <br>#allorder = Allorder.objects.filter(user=user)
                <br>#paypal_dict= 
                <br>#'business': 'Businessdk@gmail.com',
                <br>#'amount':allorder.total_cost,
                <br>#'item_name': allorder.destinations,

                <br>#####################################################################################
                <br>
                <br><strong>여기서는 @cartview에서 PLACE ORDER를 눌렀을 때 ORDER를 저장할 뿐아니라
                    checkout(주소입력)하고 payment로 가게하는 경우이다.</strong>
                <br>#Allorder Model모델에 아래 add    
                <br>#checkorder = models.ForeignKey(Checkorder, on_delete=models.CASCADE)
                <br>이 checkorder는 오더에 checkout 주소 정보가 포린 키로 연결되어 있어야 한다
                <br>그리고 Model모델에 checkorder table (name/email/postal_code/address/date/paid )있어야 한다
                <br>checkout(주소입력)을 위해 model form을 만들어서 checkout에 저장하는 방법은 전과 동
                <br>#class CheckoutForm(forms.ModelForm):
                <br>@views.py:#form = CheckoutForm()
                <br>@views.py:#return render(request, 'checkout.html', 'cart': cart,'form': form)   
                <br>@checkout.html/form action="" method="post"/form/ % csrf_token %/form.as_table/submit
                <br>@views.py:if request.method == 'POST':
                <br>@form = CheckoutForm(request.POST)
                <br>@if form.is_valid():
                <br>@cleaned_data = form.cleaned_data
                <br>@o = Checkorder/name = cleaned_data.get('name'),/email = cleaned_data.get('email'),
                <br>@postal_code = cleaned_data.get('postal_code'),/address = cleaned_data.get('address'),
                <br>@o.save()checkout에 저장
                <br><br>이 checkout 주소 정보를 Allorder 에 모든 cart_item들과 함께 저장
                <br>#all_items = Cart.objects.filter(user=user)
                <br>#checkorder = Checkorder.objects.filter(pk=o.pk)
                <br>#for cart_item in all_items:
                <br>#li = Allorder user=user, quantity = cart_item.quantity,destinations = cart_item.destinations,
                <br>#checkorder_id = o.pk:여기 checkout 주소 정보 연결 
                <br>#li.save()
                <br>#all_items.delete()
                <br>#request.session['checkorder_id'] = o.pk:여기 checkout 주소 정보 payment 연결 
                <br>#return redirect('payment',  user.pk)

            </li><br><br>

            <h3>
            <a href="...">
                <strong>PAYMENT</strong>
            </a>
            </h3>
            <br><strong>PAYPAL 사용법</strong>
            <br>1. #(https)developer.paypal.com/dashboard/ login with ID/Password same as 실제 paypal account login 
            <br>여기에  App name 앱 이름과 client ID가 먼저 등록되어있어야 한다 - App name: shop
            <br>2. Sandbox account info(SANDBOX) - #(https)www.sandbox.paypal.com/- developer 연습 목적상
            <br>Businessdk@gmail.com/persondk@gmail.com( 둘다 enough60!)
            <br>3. 장고 project setting
            <br>INSTALLED_APPS - 'paypal.standard.ipn',
            <br>PAYPAL_RECEIVER_EMAIL='businessdk@gmail.com'
            <br>PAYPAL_TEST=True
            <br>4. project@urls
            <br>#path('paypal/', include('paypal.standard.ipn.urls'))
            <br>5. app@urls
            <br>#path('paypal/', include('paypal.standard.ipn.urls')),이거는 불필요한 것같다
            <br>#path('payment/<int:user_id>/', views.payment, name='payment'),
           
            <br><br>6. @view
            <br>#from paypal.standard.forms import PayPalPaymentsForm
            <br>def payment(request, user_id):
            <br>@view - def payment(request, user_id):
            <br>#checkorder_id= request.session.get('checkorder_id')
            <br>#checkorder=get_object_or_404(Checkorder,id=checkorder_id)
            <br>반드시 있어야 할 하나의 객체인 경우(get_object_or_404)이고 없으면 404에러
            <br>#user = User.objects.get(pk=user_id)
            <br>#destination = Destination.objects.all()
            <br>#allorder = Allorder.objects.filter(user=user)
            <br>그 user의 Allorder 와 포린 정보인 Destination.objects.all() 준비
            <br>7.#host=request.get_host()
            <br>#paypal_dict
            <br>#'business': 'Businessdk@gmail.com',
            <br>#'amount':checkorder.total_cost,( 여기에 결제될 total_cost가 들어간다)
            <br>#'item_name': checkorder.name,(여기에 checkorder.name인데 입력시 오더 그룹 이름을 넣으면 사람이름대신 들어가게 할 수 잇다) 
            <br>#'return_url':'http#://{}{}'.format(host, reverse('payment_success')),
            <br>#'cancel_url':'http#://{}{}'.format(host, reverse('payment_failed' )), 


            <br>8.#form= PayPalPaymentsForm(initial=paypal_dict): 이것은 forms.py에서 오는 것아니고 import한 paypal form
            <br>#context= {'checkorder': checkorder,'user': user,'destination': destination,'allorder': allorder, 'form':form }
            <br>#return render(request, 'paypal_payment.html',context)
            <br><br>@paypal_payment.html
            <br>여기서는 모든 받아온 context로 오더 관련 정보를 보여주고 아래의 것으로 paypal 결제
            <br>9. #form.render: 이것이 paypal payment button 보여주는 것
            <br>#path('payment_success/', views.payment_success, name='payment_success'),
            <br>#def payment_success(request):
            <br>#return render(request, 'payment_success.html')

            <br>#path('payment_failed/', views.payment_failed, name='payment_failed'),
            <br>#def payment_failed(request):
            <br>#return render(request, 'payment_failed.html')

            <br>payment_success.html
            <br>payment_failed.html
        </li><br><br>



           



            </ul>
        </div>
    </div>

    <a href="{% url 'index' %}">HOME</a>
</body>
</html>

